# Der Wert des Spielers wird ausgelesen und in den Punktestand des Markierers gespeichert. Falls der Spieler nicht gefunden wurde, wird stattdessen der Wert null gespeichert.
execute store result score @s PZStraBM.1Wert run scoreboard players get @p[distance=..1,tag=EtiStraBM.1Sitzen,scores={PZStraBM.1Wert=1..}] PZStraBM.1Wert

# Die Schaltflächen für die Neigung wurden aktiviert und setzen die Eigenschaft entsprechend auf den eingestellten Wert.
data modify entity @s[scores={PZStraBM.1Wert=1}] data."EigStraBM.1Neigung" set value '{"bold":true,"color":"green","text":"Oben"}'
data modify entity @s[scores={PZStraBM.1Wert=2}] data."EigStraBM.1Neigung" set value '{"bold":true,"color":"aqua","text":"Geradeaus"}'
data modify entity @s[scores={PZStraBM.1Wert=3}] data."EigStraBM.1Neigung" set value '{"bold":true,"color":"red","text":"Unten"}'
data modify entity @s[scores={PZStraBM.1Wert=4}] data."EigStraBM.1Neigung" set value '{"bold":true,"color":"dark_purple","text":"Automatisch"}'

# Wenn die Raster-Funktion aktiviert wurde, wird die Baumaschine nur noch exakt in die Himmelsrichtungen schauen.
data modify entity @s[scores={PZStraBM.1Wert=5}] data."EigStraBM.1Raster" set value '{"bold":true,"color":"green","text":"wahr"}'
data modify entity @s[scores={PZStraBM.1Wert=6}] data."EigStraBM.1Raster" set value '{"bold":true,"color":"red","text":"falsch"}'

# Wenn der Spieler mit der Baumaschine einen Block nach vorne fahren möchte, wird geprüft, ob sich nicht bereits eine andere Baumaschine im Weg befindet. Falls ja, wird nicht die Material-Funktion geladen und stattdessen, erhält der Spieler eine Fehlermeldung.
execute at @s[scores={PZStraBM.1Wert=11}] if entity @e[distance=2..20,type=minecraft:marker,tag=EtiStraBM.1Baumaschine] run scoreboard players set @s PZStraBM.1Wert 8
execute at @s[scores={PZStraBM.1Wert=11}] as @p[distance=..5,tag=EtiStraBM.1Sitzen] run function strassenbaumaschine:v1material
execute at @s[scores={PZStraBM.1Wert=8}] run tellraw @p[distance=..5,tag=EtiStraBM.1Sitzen,scores={PZStraBM.1Wert=11}] ["Straßenbaumaschine.1:\n",{"text":"Es befindet sich eine weitere Straßenbaumaschine in der Nähe, daher wurde der Bauvorgang abgebrochen. Entferne eine Straßenbaumaschine mit der Angel um weiter bauen zu können.","color":"yellow","bold":true}]

# Wenn der Tempomat aktiviert wurde, fährt die Baumaschine automatisch nach vorne.
data modify entity @s[scores={PZStraBM.1Wert=7}] data."EigStraBM.1Tempomat" set value '{"bold":true,"color":"green","text":"wahr"}'
data modify entity @s[scores={PZStraBM.1Wert=8}] data."EigStraBM.1Tempomat" set value '{"bold":true,"color":"red","text":"falsch"}'

# Wenn die Zweierspur aktiv ist, werden zwei Spuren statt nur einer platziert.
data modify entity @s[scores={PZStraBM.1Wert=9}] data."EigStraBM.1Zweierspur" set value '{"bold":true,"color":"green","text":"wahr"}'
data modify entity @s[scores={PZStraBM.1Wert=10}] data."EigStraBM.1Zweierspur" set value '{"bold":true,"color":"red","text":"falsch"}'

# Die Auslöser-Nachricht wird dem Spieler angezeigt, wenn dieser nicht gerade den Tempomat aktiv hat und gleichzeitig das Fahren-Signal gibt. Das sorgt dafür, dass der Spieler nur beim aktiven Drücken der Schaltflächen eine Auslöser-Nachricht bekommt und beim Tempomat-Fahren nicht.
execute unless entity @s[scores={PZStraBM.1Wert=11},nbt={data:{EigStraBM.1Tempomat:'{"bold":true,"color":"green","text":"wahr"}'} }] run tellraw @p[distance=..1,tag=EtiStraBM.1Sitzen] ["Straßenbaumaschine.1:\n",{"text":"neigung = ","bold":true},{"text":"Oben","color":"gray","bold":true,"underlined":true,"hoverEvent":{"action":"show_text","contents":{"text":"Tippe für Wert Oben"} },"clickEvent":{"action":"run_command","value":"/trigger PZStraBM.1Wert set 1"} },"\n",{"text":"neigung = ","bold":true},{"text":"Geradeaus","color":"gray","bold":true,"underlined":true,"hoverEvent":{"action":"show_text","contents":{"text":"Tippe für Wert Geradeaus"} },"clickEvent":{"action":"run_command","value":"/trigger PZStraBM.1Wert set 2"} },"\n",{"text":"neigung = ","bold":true},{"text":"Unten","color":"gray","bold":true,"underlined":true,"hoverEvent":{"action":"show_text","contents":{"text":"Tippe für Wert Unten"} },"clickEvent":{"action":"run_command","value":"/trigger PZStraBM.1Wert set 3"} },"\n",{"text":"neigung = ","bold":true},{"text":"Automatisch","color":"gray","bold":true,"underlined":true,"hoverEvent":{"action":"show_text","contents":{"text":"Tippe für Wert Automatisch"} },"clickEvent":{"action":"run_command","value":"/trigger PZStraBM.1Wert set 4"} },"\n",{"text":"neigung == ","bold":true},{"entity":"@s","nbt":"data.\"EigStraBM.1Neigung\"","interpret":true},"\n",{"text":"raster (","bold":true},{"text":"=wahr","color":"gray","bold":true,"underlined":true,"hoverEvent":{"action":"show_text","contents":{"text":"Tippe für Einrastung"} },"clickEvent":{"action":"run_command","value":"/trigger PZStraBM.1Wert set 5"} },{"text":",","bold":true},{"text":"=falsch","color":"gray","bold":true,"underlined":true,"hoverEvent":{"action":"show_text","contents":{"text":"Tippe für keine Einrastung"} },"clickEvent":{"action":"run_command","value":"/trigger PZStraBM.1Wert set 6"} },{"text":") == ","bold":true},{"entity":"@s","nbt":"data.\"EigStraBM.1Raster\"","interpret":true},"\n",{"text":"tempomat (","bold":true},{"text":"=wahr","color":"gray","bold":true,"underlined":true,"hoverEvent":{"action":"show_text","contents":{"text":"Tippe für aktiven Tempomat"} },"clickEvent":{"action":"run_command","value":"/trigger PZStraBM.1Wert set 7"} },{"text":",","bold":true},{"text":"=falsch","color":"gray","bold":true,"underlined":true,"hoverEvent":{"action":"show_text","contents":{"text":"Tippe für inaktiven Tempomat"} },"clickEvent":{"action":"run_command","value":"/trigger PZStraBM.1Wert set 8"} },{"text":") == ","bold":true},{"entity":"@s","nbt":"data.\"EigStraBM.1Tempomat\"","interpret":true},"\n",{"text":"zweierspur (","bold":true},{"text":"=wahr","color":"gray","bold":true,"underlined":true,"hoverEvent":{"action":"show_text","contents":{"text":"Tippe für die Zweierspur"} },"clickEvent":{"action":"run_command","value":"/trigger PZStraBM.1Wert set 9"} },{"text":",","bold":true},{"text":"=falsch","color":"gray","bold":true,"underlined":true,"hoverEvent":{"action":"show_text","contents":{"text":"Tippe für die Einerspur"} },"clickEvent":{"action":"run_command","value":"/trigger PZStraBM.1Wert set 10"} },{"text":") == ","bold":true},{"entity":"@s","nbt":"data.\"EigStraBM.1Zweierspur\"","interpret":true},"\n",{"text":"fahren(neigung,zweierspur)","color":"gray","bold":true,"underlined":true,"hoverEvent":{"action":"show_text","contents":{"text":"Straßenbaumaschine fahren"} },"clickEvent":{"action":"run_command","value":"/trigger PZStraBM.1Wert set 11"} }]

# Damit der Spieler danach wieder die Möglichkeit erhält auf die schaltflächen zu klicken.
scoreboard players enable @p[distance=..1,tag=EtiStraBM.1Sitzen] PZStraBM.1Wert
scoreboard players set @p[distance=..1,tag=EtiStraBM.1Sitzen] PZStraBM.1Wert 0
